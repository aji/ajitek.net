<html>
  <head>
    <title>aji's cookiegen</title>
    <script src="http://orteil.dashnet.org/cookieclicker/main.js?v=1.46"></script>
    <script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>

    <script>
      function l(what) { return document.getElementById('nothing'); };
      Game.Loop = function(){};
      Game.Draw = function(){};
      Game.Logic = function(){};

      $(function(){
        Game.Init();

        var pref_particles = undefined;
        var pref_numbers = undefined;
        var pref_autosave = undefined;
        var cookies = [];
        var buildings = {}; // me, amount, bought, cookies
        var upgrades = {}; // me, unlocked, bought

        function form_to_game() {
          Game.prefs.particles = pref_particles.prop("checked");
          Game.prefs.numbers = pref_numbers.prop("checked");
          Game.prefs.autosave = pref_numbers.prop("checked");

          Game.cookies = parseInt(cookies[0].val());
          Game.cookiesEarned = parseInt(cookies[1].val());

          for (var i in buildings) {
            var bldg = buildings[i];
            var me = bldg[0];
            me.amount = parseInt(bldg[1].val());
            me.bought = parseInt(bldg[2].val());
            me.totalCookies = parseInt(bldg[3].val());
          }

          for (var i in upgrades) {
            var up = upgrades[i];
            var me = up[0];
            me.unlocked = up[1].prop("checked") ? 1 : 0;
            me.bought = up[2].prop("checked") ? 1 : 0;
          }
        }

        function game_to_form() {
          pref_particles.prop("checked", Game.prefs.particles);
          pref_numbers.prop("checked", Game.prefs.numbers);
          pref_autosave.prop("checked", Game.prefs.autosave);

          cookies[0].val(Game.cookies);
          cookies[1].val(Game.cookiesEarned);

          for (var i in buildings) {
            var bldg = buildings[i];
            var me = bldg[0];
            bldg[1].val(me.amount);
            bldg[2].val(me.bought);
            bldg[3].val(me.totalCookies);
          }

          for (var i in upgrades) {
            var up = upgrades[i];
            var me = up[0];
            up[1].prop("checked", me.unlocked);
            up[2].prop("checked", me.bought);
          }
        }

        var tbl, row;

        function cell(data) {
          var td = $("<td>");
          td.append(data);
          return td;
        }

        function textbox(name, wide, value) {
          var box = $("<input>");
          box.attr("name", name);
          box.attr("size", wide);
          box.attr("value", value);
          return box;
        }

        function checkbox(name, on) {
          var box = $("<input>");
          box.attr("name", name);
          box.attr("type", "checkbox");
          box.prop("checked", on);
          return box;
        }

        /* build preferences table */
        pref_particles = checkbox("pref_particles", true);
        pref_numbers = checkbox("pref_numbers", false);
        pref_autosave = checkbox("pref_autosave", true);
        tbl = $("<table>"); tbl.attr("border", "1"); tbl.append("<tr><th>Preference</th></tr>");
        row = $("<tr>"); row.append(cell("Particles")); row.append(pref_particles); tbl.append(row);
        row = $("<tr>"); row.append(cell("Numbers")); row.append(pref_numbers); tbl.append(row);
        row = $("<tr>"); row.append(cell("Autosave")); row.append(pref_autosave); tbl.append(row);
        $("#data").append(tbl);

        /* build cookie table */
        cookies = [textbox("cookies", 20, "0"), textbox("cookiesEarned", 20, "0")]
        tbl = $("<table>"); tbl.attr("border", "1");
        tbl.append("<tr><th>Cookies</th><th>Cookies Earned</th></tr>");
        row = $("<tr>"); row.append(cell(cookies[0])); row.append(cell(cookies[1])); tbl.append(row);
        $("#data").append(tbl);

        /* build table of buildings */
        tbl = $("<table>"); tbl.attr("border", "1");
        tbl.append("<tr><th>Building</th><th>Num owned</th><th>Num bought</th><th>Cookies made</th></tr>");
        for (var i in Game.ObjectsById) {
          var me = Game.ObjectsById[i];
          var boxes = [me,
                       textbox("b"+i+"amount", 5, "0"),
                       textbox("b"+i+"bought", 5, "0"),
                       textbox("b"+i+"cookies", 15, "0")];
          row = $("<tr>");
          row.append(cell(me.name));
          row.append(cell(boxes[1]));
          row.append(cell(boxes[2]));
          row.append(cell(boxes[3]));
          tbl.append(row);
          buildings[i] = boxes;
        }
        $("#data").append(tbl);

        /* build table of upgrades */
        tbl = $("<table>"); tbl.attr("border", "1");
        tbl.append("<tr><th>Upgrade</th><th>Unlocked</th><th>Bought</th>");
        for (var i in Game.UpgradesById) {
          var me = Game.UpgradesById[i];
          var boxes = [me,
                       checkbox("u"+i+"unlock", true),
                       checkbox("u"+i+"bought", true)];
          row = $("<tr>");
          row.append(cell(me.name));
          row.append(cell(boxes[1]));
          row.append(cell(boxes[2]));
          tbl.append(row);
          upgrades[i] = boxes;
        }
        $("#data").append(tbl);

        game_to_form();

        $("#btn_import").click(function(e) {
          var s = $("#save").val();
          Game.LoadSave(s);
          game_to_form();
        });
        $("#btn_export").click(function(e) {
          form_to_game();
          $("#save").val(Game.WriteSave(true));
        });
      });
    </script>

  </head>
  <body>
    <h1>aji's Cookie Clicker Save Generator</h1>
    <h2>For Cookie Clicker v1.021 (Spoiler alert!)</h2>
    <hr>
      <textarea id="save" cols="80" rows="4"></textarea><br />
      <button id="btn_import">Import</button>
      <button id="btn_export">Generate</button>
    <hr>
    <div id="data"></div>
    <div id="nothing" style="display:none" ></div>
    <p>Dear Orteil: If you want this taken down, let me know. It was just
      a silly toy I created as a sort of proof of concept. I made it after
      "beating" the game (by unlocking all the unlockables). Great game,
      by the way. I had a lot of fun playing it.</p>
  </body>
</html>
